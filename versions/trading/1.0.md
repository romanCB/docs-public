# The External Game Platform Provider Trading API Specification

#### Version 1.0

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC 2119].

## 1. Introduction

The External Game Platform Provider Trading API Specification for external game platform providers.

## 2. Revision History

Version | Date | Notes | Author
--- | --- | --- | ---
1.0 | 2016-12-09 | Initial release of the formal document. | Krzysztof Bończak

## 3. Definitions

## 4. References

### 4.1 Normative References

[[RFC2119]](http://www.ietf.org/rfc/rfc2119.txt)  Brandner, S., “Key words for use in RFCs to Indicate Requirement Levels,” March 1997.  
[[OAuth.Responses]](http://openid.net/specs/oauth-v2-multiple-response-types-1_0.html) 	de Medeiros, B., Ed., Scurtescu, M., Tarjan, P., and M. Jones, “OAuth 2.0 Multiple Response Type Encoding Practices,” February 2014.  
[[OpenID.Core]](http://openid.net/specs/openid-connect-core-1_0.html) 	Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, “OpenID Connect Core 1.0,” August 2015.  
[[OpenID.Discovery]](http://openid.net/specs/openid-connect-discovery-1_0.html) 	Sakimura, N., Bradley, J., Jones, M., and E. Jay, “OpenID Connect Discovery 1.0,” August 2015.  
[[OpenID.Registration]](http://openid.net/specs/openid-connect-registration-1_0.html) 	Sakimura, N., Bradley, J., and M. Jones, “OpenID Connect Dynamic Client Registration 1.0,” August 2015.  
[[RFC3339]](http://www.rfc-editor.org/info/rfc3339) 	Klyne, G. and C. Newman, “Date and Time on the Internet: Timestamps,” RFC 3339, DOI 10.17487/RFC3339, July 2002.  
[[RFC3986]](http://www.rfc-editor.org/info/rfc3986) 	Berners-Lee, T., Fielding, R., and L. Masinter, “Uniform Resource Identifier (URI): Generic Syntax,” STD 66, RFC 3986, DOI 10.17487/RFC3986, January 2005.  
[[RFC4627]](http://www.rfc-editor.org/info/rfc4627) 	Crockford, D., “The application/json Media Type for JavaScript Object Notation (JSON),” RFC 4627, DOI 10.17487/RFC4627, July 2006.  
[[RFC5246]](http://www.rfc-editor.org/info/rfc5246) 	Dierks, T. and E. Rescorla, “The Transport Layer Security (TLS) Protocol Version 1.2,” RFC 5246, DOI 10.17487/RFC5246, August 2008.  
[[RFC6125]](http://www.rfc-editor.org/info/rfc6125) 	Saint-Andre, P. and J. Hodges, “Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS),” RFC 6125, DOI 10.17487/RFC6125, March 2011.  
[[RFC6711]](http://www.rfc-editor.org/info/rfc6711) 	Johansson, L., “An IANA Registry for Level of Assurance (LoA) Profiles,” RFC 6711, DOI 10.17487/RFC6711, August 2012.  
[[RFC6749]](http://www.rfc-editor.org/info/rfc6749,https://oauth.net/2/) 	Hardt, D., Ed., “The OAuth 2.0 Authorization Framework,” RFC 6749, DOI 10.17487/RFC6749, October 2012.  
[[RFC6750]](http://www.rfc-editor.org/info/rfc6750) 	Jones, M. and D. Hardt, “The OAuth 2.0 Authorization Framework: Bearer Token Usage,” RFC 6750, DOI 10.17487/RFC6750, October 2012.  
[[RFC7159]](http://www.rfc-editor.org/info/rfc7159) 	Bray, T., Ed., “The JavaScript Object Notation (JSON) Data Interchange Format,” RFC 7159, DOI 10.17487/RFC7159, March 2014.  
[[ISO4217]](http://www.iso.org/iso/home/standards/currency_codes.htm)  “Currency codes - ISO 4217”.  
[[W3C.REC-html5-20141028]](https://www.w3.org/TR/html5/)  Hickson, I., Berjon, R., Faulkner, S., Leithead, T., Doyle Navara, E., O'Connor, E., Pfeiffer, S., “HTML5 Specification,” World Wide Web Consortium Recommendation REC-html5-20141028, October 2014.  

### 4.2 Informative References

[[JSON.Schema]](http://json-schema.org)  “JSON Schema”.  

## 5. Specification

### 5.1 Format


### File Structure

The External Game Platform Provider representation of the trading API is made of a single file. However, parts of the definitions can be split into separate files, at the discretion of the user. This is applicable for `$ref` fields in the specification as follows from the [JSON Schema] definitions.

By convention, the External Game Plaftorm Provider Trading specification file is named `egpp-trading.json`.

### Data Types

#### 4.3.1 Primitives

Different programming languages represent primitives differently. The External Game Platform Provider specification supports by name only the primitive types supported by the [JSON-Schema]. However, in order to allow fine tuning a primitive definition, an additional [`format`](#dataTypeFormat) field MAY accompany the [`type`](#dataTypeType) primitive to give more information about the type used. If the [`format`](#dataTypeFormat) field is used, the respective client MUST conform to the elaborate type.

Common Name | [`type`](#dataTypeType) | [`format`](#dataTypeFormat) | Comments
----------- | ------ | -------- | --------
integer | `integer` | `int32` | signed 32 bits
long | `integer` | `int64` | signed 64 bits
float | `number` | `float` |
double | `number` | `double` |
string | `string` | |
byte | `string` | `byte` |
boolean | `boolean` | |
date | `string` | `date` |
dateTime | `string` | `date-time` |


### Schema

#### Versioning

Each http call to 1.0 protocol version should follows the pattern `scheme:[//host[:port]][/]v1.0[/]path`

#### <a name="statusSection"></a>Status

	HTTP header: status, description - according to HTTP RFC or provider specific object

##### Fixed fields

Field Name | Type | Size | Description
---|:---|---:|---
code | `string` | {1-20} | **Required.** error code eg.  404 - PLAYER_NOT_FOUND,  500 - INTERNAL_ERROR, OK,  503 - TEMPORARILY_UNAVAILABLE,  501 - NOT_IMPLEMENTED
error | `string` | {1-200} | **Optional.** stack trace
description | `string` | {1-100} | **Optional.** error description in english language
parameters | `string` | {1-100} | **Optional.** key:value pairs to fill description in other languages than english

##### Status object example

HTTP status code = 500 (only when HTTP layer takes part in communication protocols stack)

```js
{
	"code": "500",
	"error": "detailed information about error root cause",
	"description": "Internal server error occured. Please try again in 5 minutes",
	"parameters": ["key1":"value1","key2":"value2"]
}
```

```yaml
code: 500
error: detailed information about error root cause
description: Internal server error occured. Please try again in 5 minutes
parameters: [key1:value1, key2:value2]
```

#### Authentication

See [Authentication API 1.0 Specification](../authentication/1.0.md)


#### 5.1.1 Get trader account balance

Authentication: Bearer `authToken`

Request object

##### Fixed fields

Field Name | Type | Size | Description
---|:---|---:|---
currency | `string` | 3 | **Required.** Currency type according to ISO 4217 and BTC


Response object or see [`status`](#statusSection) object

##### Fixed fields

Field Name | Type | Size | Description
---|:---|---:|---
balance | `integer` | int32 | **Required.** Total balance for specified currency type
currency | `string` | 3 | **Required.** Currency type according to ISO 4217 and BTC

##### Get account balance object example


```js
{
	"currency": "CHF"
}
```

```yaml
currency: CHF
```

#### 5.1.2 Bet

Authentication: Bearer `authToken`

Request object

##### Fixed fields

Filed Name | Type | Size | Description 
---|:---|---:|---
amount | `integer` | int32 | **Required.** Bet amount in pennies, positive integer only
currency | `string` | 3 | **Required.** Currency type according to ISO 4217 and BTC
game | `string` | {1-3} | **Required.** Game type symbol eg: WSR, WSB, WF, WB, RFX etc...
roundId | `string` | int32 | **Required.** Game round, positive integer only
externalId | `string` | {1-16} | **Required.** Unique game identifier for game provider

Response object

See [`status`](#statusSection) object

##### Bet object example

```js
{
	"amount": 1234,
	"currency": "CHF",
	"game": "WSR",
	"roundId": 1,
	"externalId": "2243"
}
```

```yaml
amount: 1234
currency: CHF
game: WSR
roundId: 1
externalId: 2243
```

#### 5.1.3 Win/Loose

Authentication: Bearer `authToken`

Request object

##### Fixed fields

Field Name | Type | Size | Description
---|:---|---:|---
amount | `integer` | int32 | **Required.** Win/loose amount in pennies, positive or negative integer
currency | `string` | 3 | **Required.** Currency type according to ISO 4217 and BTC
game | `string` | {1-3} | **Required.** Game type symbol eg: WSR, WSB, WF, WB, RFX etc...
roundId | `string` | int32 | **Required.** Game round, positive integer only
externalId | `string` | {1-16} | **Required.** Unique game identifier for game provider

Response object

See [`status`](#statusSection) object

##### Win/Loose object example

```js
{
	"amount": 1234,
	"currency": "CHF",
	"game": "WSR",
	"roundId": 1,
	"externalId": "2243"
}
```

```yaml
amount: 1234
currency: CHF
game: WSR
roundId: 1
externalId: 2243
```

#### 5.1.4 Cancel bet

Authentication: Bearer `authToken`

Request object

##### Fixed fields

Field Name | Type | Size | Description
---|:---|---:|---
amount | `integer` | int32 | **Required.** Refunded amount in pennies, positive integer only
currency | `string` | 3 | **Required.** Currency type according to ISO 4217 and BTC
game | `string` | {1-3}] | **Required.** game type symbol eg: WSR, WSB, WF, WB, RFX etc...
externalId | `string` | {1-16} | **Required.** Unique game identifier for game provider

Response object

See [`status`](#statusSection) object

##### Cancel bet object example

```js
{
	"amount": 1234,
	"currency": "CHF",
	"game": "WSR",
	"externalId": "2243"
}
```

```yaml
amount: 1234
currency: CHF
game: WSR
externalId: 2243
```
